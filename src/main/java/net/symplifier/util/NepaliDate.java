package net.symplifier.util;

import java.util.Date;
import java.util.TimeZone;

/**
 * Created by ranjan on 6/24/15.
 */
public class NepaliDate {
  private Date date;

  private int year;
  private int month;
  private int day;

  public NepaliDate(Date date) {
    setDate(date);
  }

  public NepaliDate(TimeZone timeZone, Date date) {
    setDate(timeZone, date);
  }

  public void setDate(Date date) {
    this.setDate(TimeZone.getDefault(), date);
  }

  public void setDate(TimeZone timeZone, Date date) {
    this.date = date;

    long ts = date.getTime();
    // TODO Confirm if the following operation is an addition or substraction
    ts += timeZone.getOffset(ts);

    int numberOfDays = (int)(ts / 86400000);

    int bsEpoch = numberOfDays + EPOCH_DIFFERENCE_DAYS;
    int numberOfCycles = bsEpoch / CYCLE_DAYS;
    year = numberOfCycles * CYCLE_YEARS + EPOCH_YEAR;

    int x = bsEpoch % CYCLE_DAYS;
    if (x < 0) {
      x += CYCLE_DAYS;
    }

    // Get a rough starting point
    int idx = x / 365;
    if (idx >= CYCLE_YEARS) {
      idx = CYCLE_YEARS - 1;
    }
    int daysInYear = -1;
    for(;daysInYear<0; idx--) {
      daysInYear = x - CALENDAR_MONTHS_DAYS_MAP[idx][0];
    }
    idx++;
    year += idx;

    month = 1;
    for(; month<12; ++month) {
      int c = CALENDAR_MONTHS_DAYS_MAP[idx][month];
      if (daysInYear < c) {
        break;
      }
      daysInYear -= c;
    }

    day = daysInYear + 1;
  }

  public int getYear() {
    return year;
  }

  public int getMonth() {
    return month;
  }

  public int getDay() {
    return day;
  }

  public static long getTimestamp(int year, int month, int day) {
    return getTimestamp(TimeZone.getDefault(), year, month, day);
  }
  public static long getTimestamp(TimeZone timeZone, int year, int month, int day) {
    long res = 0;
    int epochDiff = year - EPOCH_YEAR;
    int x = epochDiff / CYCLE_YEARS;
    res = x * CYCLE_DAYS;

    x = epochDiff % CYCLE_YEARS;
    if (x < 0) {
      x = CYCLE_YEARS + x;
    }

    res += CALENDAR_MONTHS_DAYS_MAP[x][0];
    for(int i=1; i<month; ++i) {
      res += CALENDAR_MONTHS_DAYS_MAP[x][i];
    }

    res += day-1;
    res -= EPOCH_DIFFERENCE_DAYS;

    res = res * 86400000;
    res -= timeZone.getOffset(res);
    return res;
  }

  public static String[] getMonthTexts() {
    return MONTH_TEXTS;
  }

  public static final int EPOCH_DIFFERENCE_DAYS = -10695;
  public static final int EPOCH_YEAR = 2056;
  public static final int EPOCH_MONTH = 1;
  public static final int EPOCH_DAY = 1;
  public static final int EPOCH_DOW_OFFSET = 3;

  public static final int CYCLE_DAYS = 50771;
  public static final int CYCLE_YEARS = 139;

  public static final int CALENDAR_MONTHS_DAYS_MAP[][] = {
          {    0, 31, 31, 32, 31, 32, 30, 30, 29, 30, 29, 30, 30 }, // 0
          {  365, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 1
          {  731, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 2
          { 1096, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 3
          { 1461, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 4
          { 1826, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 5
          { 2192, 30, 32, 31, 32, 31, 31, 29, 30, 29, 30, 29, 31 }, // 6
          { 2557, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 7
          { 2922, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 8
          { 3287, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 9
          { 3653, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 29, 31 }, // 10
          { 4018, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 11
          { 4383, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 12
          { 4748, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 13
          { 5114, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30 }, // 14
          { 5479, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 15
          { 5844, 31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 16
          { 6209, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 17
          { 6575, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30 }, // 18
          { 6940, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 19
          { 7305, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30 }, // 20
          { 7670, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 21
          { 8036, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30 }, // 22
          { 8401, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 23
          { 8766, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30 }, // 24
          { 9131, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 25
          { 9497, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 26
          { 9862, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 27
          { 10227, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 28
          { 10593, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 29
          { 10958, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 30
          { 11323, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 31
          { 11688, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 32
          { 12054, 30, 32, 31, 32, 31, 31, 29, 30, 29, 30, 29, 31 }, // 33
          { 12419, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 34
          { 12784, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 35
          { 13149, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 36
          { 13515, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 29, 31 }, // 37
          { 13880, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 38
          { 14245, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 39
          { 14610, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 40
          { 14976, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30 }, // 41
          { 15341, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 42
          { 15706, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 43
          { 16071, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 44
          { 16437, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30 }, // 45
          { 16802, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 46
          { 17167, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30 }, // 47
          { 17532, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 48
          { 17898, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30 }, // 49
          { 18263, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 50
          { 18628, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30 }, // 51
          { 18993, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 52
          { 19359, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 53
          { 19724, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 54
          { 20089, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 55
          { 20455, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 56
          { 20820, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 57
          { 21185, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 58
          { 21550, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 59
          { 21916, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 60
          { 22281, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 61
          { 22646, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 62
          { 23011, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 63
          { 23377, 31, 31, 31, 32, 31, 31, 29, 30, 29, 30, 29, 31 }, // 64
          { 23742, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 65
          { 24107, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 66
          { 24472, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 67
          { 24838, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30 }, // 68
          { 25203, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 69
          { 25568, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 70
          { 25933, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 71
          { 26299, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30 }, // 72
          { 26664, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 73
          { 27029, 31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 74
          { 27394, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 75
          { 27760, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30 }, // 76
          { 28125, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 77
          { 28490, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30 }, // 78
          { 28855, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 79
          { 29221, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 80
          { 29586, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 81
          { 29951, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30 }, // 82
          { 30316, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 83
          { 30682, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 84
          { 31047, 31, 31, 32, 31, 32, 30, 30, 29, 30, 29, 30, 30 }, // 85
          { 31412, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 86
          { 31778, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 87
          { 32143, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 88
          { 32508, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 89
          { 32873, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 90
          { 33239, 31, 31, 31, 32, 31, 31, 29, 30, 29, 30, 29, 31 }, // 91
          { 33604, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 92
          { 33969, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 93
          { 34334, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 94
          { 34700, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30 }, // 95
          { 35065, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 96
          { 35430, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 97
          { 35795, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 98
          { 36161, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30 }, // 99
          { 36526, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 100
          { 36891, 31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 101
          { 37256, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 102
          { 37622, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30 }, // 103
          { 37987, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 104
          { 38352, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30 }, // 105
          { 38717, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 106
          { 39083, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 107
          { 39448, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 108
          { 39813, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30 }, // 109
          { 40178, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 110
          { 40544, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 111
          { 40909, 31, 31, 32, 31, 32, 30, 30, 29, 30, 29, 30, 30 }, // 112
          { 41274, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 113
          { 41640, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 114
          { 42005, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 115
          { 42370, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 116
          { 42735, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 117
          { 43101, 31, 31, 31, 32, 31, 31, 29, 30, 29, 30, 29, 31 }, // 118
          { 43466, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 119
          { 43831, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 120
          { 44196, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 121
          { 44562, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30 }, // 122
          { 44927, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 123
          { 45292, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 124
          { 45657, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 125
          { 46023, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30 }, // 126
          { 46388, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 127
          { 46753, 31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30 }, // 128
          { 47118, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31 }, // 129
          { 47484, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30 }, // 130
          { 47849, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 131
          { 48214, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30 }, // 132
          { 48579, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 133
          { 48945, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30 }, // 134
          { 49310, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }, // 135
          { 49675, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30 }, // 136
          { 50040, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31 }, // 137
          { 50406, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30 }  // 138
  };

  public static final String MONTH_TEXTS[] = {
          "Baisakh", "Jesth", "Asar", "Shrawan", "Bhadra", "Aswin",
          "Kartik", "Mangsir", "Poush", "Magh", "Falgun", "Chaitra"
  };

  public static final String DAY_TEXTS[] = {
          "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"
  };


}
